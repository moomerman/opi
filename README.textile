h1. Opi - The very opinionated API service library

h2. Current Status

Needs docs

h2. Install the gem

gem 'opi'

h2. About

Opi is a very opinionated rack-compliant API service library.  In fact, it is
so opinionated it is very likely to offend.  But that is alright.

Opi was born out of frustration with writing too much boilerplate code for api
services.

*JSON-only*.  The server CANNOT respond with anything else other than JSON.
All error responses are JSON out of the box.  You CANNOT respond with HTML.
The response content type is hardcoded to JSON.

*No Controllers*.  Well.. there are route blocks which are the equivalent
of the controller but you are strongly encouraged to only ever execute actions
in these blocks (the server is looking out for those actions as responses).
The only role of the 'controller' here is to map HTTP inputs to Action inputs.

*Action-based*.  All logic is an action.  Actions validate their own inputs
and have no access to anything HTTP-related.  These are domain-specific actions
that can be pulled out and used anywhere.

*No Sessions or Cookies*.  None.

But this has its advantages.  It is *fast* and *simple*.

h2. Example

This simple example doens't really go into the detail of Actions but it does
demonstrate the routes, responses, before filters and helpers.

<code>api.rb</code>

<pre><code>module Example
  class API < Opi::API

    before :authorize!

    get '/ping', :skip => :authorize! do
      {:pong => Time.now.to_i}
    end

    get '/meaning' do
      {:answer => 42}
    end

    helpers do
      def authorize!
        error!('401 Unauthorized', 401) unless params['secret'] == '1234'
      end
    end

  end
end
</code></pre>

<code>config.ru</code>

<pre><code>require 'opi'

load './api.rb'
run Example::API.new
</code></pre>

<code>output</code>

<pre><code>$ curl -i http://0.0.0.0:9292/ping
HTTP/1.1 200 OK
Content-Type: application/json
Transfer-Encoding: chunked

{"pong":1387810814}

$ curl -i http://0.0.0.0:9292/meaning
HTTP/1.1 401 Unauthorized
Content-Type: application/json
Transfer-Encoding: chunked

{"error":"401 Unauthorized"}

$ curl -i http://0.0.0.0:9292/meaning?secret=1234
HTTP/1.1 200 OK
Content-Type: application/json
Transfer-Encoding: chunked

{"answer":42}

$ curl -i http://0.0.0.0:9292/nonexistant
HTTP/1.1 404 Not Found
Content-Type: application/json
Transfer-Encoding: chunked

{"error":"404 Not Found"}
</code></pre>